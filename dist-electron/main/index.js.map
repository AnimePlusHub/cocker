{"version":3,"file":"index.js","sources":["../../electron/main/index.ts"],"sourcesContent":["import {app,BrowserWindow,shell,ipcMain} from 'electron'\nimport { release } from 'os'\nimport { join } from 'path'\nimport { argv } from 'process'\n\n\n\nprocess.env.DIST_ELCTRON = join(__dirname,'..')\nprocess.env.DIST = join(process.env.DIST_ELCTRON,'../dist')\nprocess.env.VITE_PUBLIC = process.env.VITE_DEV_SERVER_URL ? join(process.env.DIST_ELCTRON,'../public') :process.env.DIST\n\n\n\n//DIsable GPU Aceeleration for windows7\nif(release().startsWith('6.1')) app.disableHardwareAcceleration()\n\n//设置应用名称\nif(process.platform === 'win32') app.setAppUserModelId(app.getName())\n\n//如果别的同样应用在跑则退出\nif(!app.requestSingleInstanceLock()){\n    app.quit()\n    process.exit(0)\n}\n\n\nlet win:BrowserWindow | null = null\nconst preload = join(__dirname,'../preload/index.js')\nconst url = process.env.VITE_DEV_SERVER_URL\nconst indexHtml = join(process.env.DIST,'index.html')\n\nasync function createWindow() {\n    win = new BrowserWindow({\n        title: 'Main window',\n        icon: join(process.env.VITE_PUBLIC,'favicon.ico'),\n        webPreferences:{\n            preload,\n            nodeIntegration: true,\n            contextIsolation: false,\n        }\n    })\n\n    if(process.env.VITE_DEV_SERVER_URL){\n        win.loadURL(url)\n        win.webContents.openDevTools()\n    }else{\n        win.loadFile(indexHtml)\n    }\n    \n    win.webContents.on('did-finish-load',()=>{\n        win?.webContents.send('main-process-message',new Date().toLocaleString())\n    })\n\n    //链接使用浏览器打开\n    win.webContents.setWindowOpenHandler(({url})=>{\n        if(url.startsWith('https:')) shell.openExternal(url)\n        return {action:'deny'}\n    })\n}\napp.whenReady().then(createWindow)\n\napp.on('window-all-closed',()=>{\n    win = null\n    if(process.platform !== 'darwin') app.quit()\n})\n\napp.on('second-instance',()=>{\n    if(win){\n        if(win.isMinimized()) win.restore()\n        win.focus()\n    }\n})\napp.on('activate',()=>{\n    const allWindows = BrowserWindow.getAllWindows()\n    if(allWindows.length){\n        allWindows[0].focus()\n    }else{\n        createWindow()\n    }\n})\n\nipcMain.handle('opn-win',(_,arg)=>{\n    const childWindow = new BrowserWindow({\n        webPreferences:{\n            preload,\n            nodeIntegration:true,\n            contextIsolation: false,\n        },\n    })\n    if(process.env.VITE_DEV_SERVER_URL){\n        childWindow.loadURL(`${url}#${arg}`)\n    }else{\n        childWindow.loadFile(indexHtml,{hash:arg})\n    }\n})\n"],"names":["join","release","app","BrowserWindow","url","shell","ipcMain"],"mappings":";;;;AAOA,QAAQ,IAAI,eAAeA,KAAK,KAAA,WAAU,IAAI;AAC9C,QAAQ,IAAI,OAAOA,KAAA,KAAK,QAAQ,IAAI,cAAa,SAAS;AAC1D,QAAQ,IAAI,cAAc,QAAQ,IAAI,sBAAsBA,KAAA,KAAK,QAAQ,IAAI,cAAa,WAAW,IAAG,QAAQ,IAAI;AAKpH,IAAGC,WAAU,EAAA,WAAW,KAAK;AAAGC,WAAA,IAAI,4BAA4B;AAGhE,IAAG,QAAQ,aAAa;AAAaA,WAAAA,IAAA,kBAAkBA,aAAI,QAAS,CAAA;AAGpE,IAAG,CAACA,SAAAA,IAAI,6BAA4B;AAChCA,WAAA,IAAI,KAAK;AACT,UAAQ,KAAK,CAAC;AAClB;AAGA,IAAI,MAA2B;AAC/B,MAAM,UAAUF,KAAK,KAAA,WAAU,qBAAqB;AACpD,MAAM,MAAM,QAAQ,IAAI;AACxB,MAAM,YAAYA,KAAA,KAAK,QAAQ,IAAI,MAAK,YAAY;AAEpD,eAAe,eAAe;AAC1B,QAAM,IAAIG,SAAAA,cAAc;AAAA,IACpB,OAAO;AAAA,IACP,MAAMH,KAAAA,KAAK,QAAQ,IAAI,aAAY,aAAa;AAAA,IAChD,gBAAe;AAAA,MACX;AAAA,MACA,iBAAiB;AAAA,MACjB,kBAAkB;AAAA,IACtB;AAAA,EAAA,CACH;AAEE,MAAA,QAAQ,IAAI,qBAAoB;AAC/B,QAAI,QAAQ,GAAG;AACf,QAAI,YAAY;EAAa,OAC5B;AACD,QAAI,SAAS,SAAS;AAAA,EAC1B;AAEI,MAAA,YAAY,GAAG,mBAAkB,MAAI;AACrC,+BAAK,YAAY,KAAK,6CAA2B,KAAK,GAAE;EAAgB,CAC3E;AAGD,MAAI,YAAY,qBAAqB,CAAC,EAAC,KAAAI,WAAO;AACvCA,QAAAA,KAAI,WAAW,QAAQ;AAAGC,qBAAM,aAAaD,IAAG;AAC5C,WAAA,EAAC,QAAO;EAAM,CACxB;AACL;AACAF,SAAI,IAAA,UAAY,EAAA,KAAK,YAAY;AAEjCA,SAAAA,IAAI,GAAG,qBAAoB,MAAI;AACrB,QAAA;AACN,MAAG,QAAQ,aAAa;AAAUA,aAAA,IAAI,KAAK;AAC/C,CAAC;AAEDA,SAAAA,IAAI,GAAG,mBAAkB,MAAI;AACzB,MAAG,KAAI;AACH,QAAG,IAAI,YAAY;AAAG,UAAI,QAAQ;AAClC,QAAI,MAAM;AAAA,EACd;AACJ,CAAC;AACDA,SAAAA,IAAI,GAAG,YAAW,MAAI;AACZ,QAAA,aAAaC,uBAAc;AACjC,MAAG,WAAW,QAAO;AACN,eAAA,CAAC,EAAE;EAAM,OACnB;AACY;EACjB;AACJ,CAAC;AAEDG,SAAA,QAAQ,OAAO,WAAU,CAAC,GAAE,QAAM;AACxB,QAAA,cAAc,IAAIH,uBAAc;AAAA,IAClC,gBAAe;AAAA,MACX;AAAA,MACA,iBAAgB;AAAA,MAChB,kBAAkB;AAAA,IACtB;AAAA,EAAA,CACH;AACE,MAAA,QAAQ,IAAI,qBAAoB;AAC/B,gBAAY,QAAQ,GAAG,GAAG,IAAI,GAAG,EAAE;AAAA,EAAA,OAClC;AACD,gBAAY,SAAS,WAAU,EAAC,MAAK,IAAI,CAAA;AAAA,EAC7C;AACJ,CAAC;"}